<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<!--     <link rel="import" href="bower_components/iron-scaffold/iron-scaffold.html"> -->
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">

<link rel="import" href="../bower_components/paper-styles/paper-styles-classes.html">

<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">


<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<!--     <link rel="import" href="bower_components/flatiron-director/flatiron-director.html"> -->
<!-- <link rel="import" href="../bower_components/font-roboto/roboto.html"> -->
<!-- <link rel="import" href="../bower_components/iron-a11y-keys/iron-a11y-keys.html"> -->
<!-- <link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"> -->
<link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html">
<!-- <link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html"> -->

<link rel="import" href="../styles/app-theme.html">

<link rel="import" href="../elements/login-box.html">

<link rel="import" href="../elements/server-config.html">

<link rel="import" href="home.html">
<link rel="import" href="trips.html">
<link rel="import" href="profile.html">
<link rel="import" href="tracking.html">

<link rel="import" href="create-trip.html">

<link rel="import" href="../elements/pop-up.html">

<!-- <link rel="import" href="../elements/login-box.html"> -->

<dom-module name="main-view">
  <style>
    /*.loginPos {
	position: absolute;
	top: 45px;
	right: 45px;
	display: {{displayLogin}};
    }*/
    /*:host {
      --login-box-theme: {
	position: absolute;
	top: 45px;
	right: 45px;
	display: {{displayLogin}};
      };
    }*/
    login-box {
      position: absolute;
      top: 45px;
      right: 45px;
/*       display: {{displayLogin}}; */ /*YA NO FUNCIONA, SOLO EN LA 0.5*/
    }
  </style>
  
  <template id="app">
    
  	<server-config></server-config>
    <!-- Route controller. -->
<!--       <flatiron-director route="{{route}}" autoHash></flatiron-director> -->
    
    <!-- Keyboard nav controller. -->
<!--    <iron-a11y-keys target="{{parentElement}}"
	      keys="up down left right"
	      on-keys-pressed="{{keyHandler}}">
    </iron-a11y-keys>-->
    
    <!-- Dynamic content controller -->
<!--    <iron-ajax auto id="ajax" url="{{selectedPage.page.url}}" handleAs="document"
	      on-iron-response="{{onResponse}}">
    </iron-ajax>-->
    
    <iron-localstorage name="session3" value="{{session}}"></iron-localstorage>
    
    <paper-drawer-panel id="paperDrawerPanel">
      <!-- Drawer Scroll Header Panel -->
      <paper-scroll-header-panel drawer fixed>
				<!-- Drawer Toolbar -->
				<paper-toolbar id="drawerToolbar" class="title-bar">
				  <span class="paper-font-title">Teranga Go!</span>
				</paper-toolbar>
				
				<!-- Drawer Content -->
				<paper-menu class="list" attr-for-selected="route-hash" selected="{{route}}" on-iron-select="menuItemSelected">
				  <template is="dom-repeat" items="{{pages}}" as="page">
				    <a route-hash="{{page.hash}}" href="{{page.url}}">
				      <iron-icon icon="label-outline"></iron-icon>
				      <span>{{page.name}}</span>
				    </a>
			<!--	    <paper-item hash="{{page.hash}}">
				      <iron-icon icon="label-outline"></iron-icon>
				      <a href="#{{page.hash}}">{{page.name}}</a>
				    </paper-item>-->
				  </template>
				</paper-menu>
      </paper-scroll-header-panel>

      <!-- Main Area -->
      <!-- <paper-header-panel main mode="waterfall"> -->
      <paper-scroll-header-panel main fixed>
				<!-- Main Toolbar -->
				<paper-toolbar id="mainToolBar" class="title-bar">
			  <!-- 	<div class="flex">{{selectedPage.page.name}}</div> -->
				  <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle></paper-icon-button>
				  <span class="flex"></span>
				  
				  <!-- Toolbar icons -->
				  <template is="dom-if" if="[[session.user]]">
					  <div class="paper-icon-header-div layout horizontal center">
					  	<paper-icon-button class="paper-icon-header" icon="menu"></paper-icon-button>
					  </div>
					  <div class="paper-icon-header-div layout horizontal center">
					  	<paper-icon-button class="paper-icon-header" icon="account-circle" on-tap="loginIconClicked"></paper-icon-button>
					  </div>
				  </template>

				  <template is="dom-if" if="[[!session.user]]">
					  <paper-button class="paper-icon-header layout horizontal center">Loguearse</paper-button>
					  <paper-button class="layout horizontal center paper-icon-header">Registrarse</paper-button>
				  </template>
				  
				  <!-- Application name -->
				  <!-- <div class="middle paper-font-display2 app-name"></div> -->
				  
				  <!-- Application sub title -->
				  <!-- <div class="bottom title"></div> -->
				</paper-toolbar>
				
				<!-- Main Content -->
				<div id="body-content">
				  <iron-pages id="pages" attr-for-selected="hash" selected="{{route}}">
				    <section hash="home">
				    	<!-- <template> -->
				      	<home-view session="{{session}}" route="{{route}}"></home-view>
				      <!-- </template> -->
				    </section>
				    <section hash="profile">
				    	<!-- <template> -->
				      	<profile-view session="{{session}}" route="{{route}}"></profile-view>
				      <!-- </template> -->
				    </section>
				    <section hash="trips">
				    	<!-- <template> -->
				      	<trips-view session="{{session}}" route="{{route}}"></trips-view>
				      <!-- </template> -->
				    </section>
				    <section hash="tracking">
				    	<!-- <template> -->
				      	<tracking-view session="{{session}}" route="{{route}}" idpackage="[[params.idpackage]]"></tracking-view>
				      <!-- </template> -->
				    </section>
				    <!-- <section hash="createTrip">
				    	<create-trip user="[[session.user]]"></create-trip>
				    </section> -->
				  </iron-pages>
				</div>
			      
			<!--       </iron-scaffold> -->
      </paper-scroll-header-panel>
    </paper-drawer-panel>
    
    <login-box class$="{{displayLogin}}" session="{{session}}"></login-box>
    
<!--     <iron-localstorage name="session" value="{{session}}"></iron-localstorage> -->
  </template>
  
  <script>
    Polymer({
      is: "main-view",
      properties: {
				route: {	//多多多TO POSSIBLY REMOVE IF USING FLATIRON OR... 多PAGE.JS? ????
				  type: String,
				  value: "home",
				  observer: 'routeChanged'
				},
				params: Object,
				displayLogin: {
				  type: String,
				  value: "hidden"
				},
				pages: {
				  type: Object,
				  value: [
				    {name: 'Inicio', hash: 'home', url: '/'},
				    {name: 'Viajes', hash: 'trips', url: '/trips'},
				    {name: 'Perfil', hash: 'profile', url: '/profile'},
				    {name: 'Register', hash: 'register', url: '/register'},
				    {name: 'Tracking', hash: 'tracking', url: '/tracking'}
				  ]
				},
				session: {
				  type: Object,
				  value: {}
				}
      },
      
      ready: function() {
			// 	if(!this.session) this.session = {};
			// 	this.session = null;
      },
      
      loginIconClicked: function(e, detail, sender) {
				console.log("loginIconClicked");
				this.displayLogin = this.displayLogin == "" ? "hidden" : "";
				console.log("DisplayLogin: " + this.displayLogin);
      },
      
//       keyHandler: function(e, detail, sender) {
// 	var pages = Polymer.dom(document).querySelector('#pages');
// 
// 	switch (detail.key) {
// 	  case 'left':
// 	  case 'up':
// 	    pages.selectPrevious();
// 	    break;
// 	  case 'right':
// 	  case 'down':
// 	    pages.selectNext();
// 	    break;
//   // 	case 'space':
//   // 	  detail.shift ? pages.selectPrevious() : pages.selectNext();
//   // 	  break;
// 	}
//       },
      
      menuItemSelected: function() {
				console.log("menuItemSelected");
			// 	var drawerPanel = Polymer.dom(this).querySelector("#paperDrawerPanel");
				var drawerPanel = this.$.paperDrawerPanel;
				if(drawerPanel.narrow) drawerPanel.closeDrawer();
			// 	console.log(this.session);
      },

      routeChanged: function() {
      	if(this.route === "profile") this.$$("profile-view").edit = false;
      	else if(this.route === "tracking") this.$$("tracking-view").back();
      }
    });    
  </script>
</dom-module>