<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="../elements/stars-rating.html">

<dom-module name="trip-card">
  
  <style>

    /*:host {
      display: block;
      position: relative;
      background-color: white;
      padding: 20px;
      width: 100%;
      font-size: 1.2rem;
      font-weight: 300;
    }
    .card-header {
      margin-bottom: 10px;
    }
    polyfill-next-selector { content: '.card-header h2'; }
    .card-header ::content h2 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: bold;
    }
    polyfill-next-selector { content: '.card-header h3'; }
    .card-header ::content h3 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: bolder;
    }
    polyfill-next-selector { content: '.card-header img'; }
    .card-header ::content img {
      width: 70px;
      border-radius: 50%;
      margin: 10px;
    }
    :host([selected]) paper-icon-button {
      color: #da4336;
    }*/
    .trip-card-div {
      border: 1px solid #ccc;
      margin: 10px;
    }
    .trip-card-img {
      width: 70px;
      height: 70px;
    }

    .trip-card-seat {
      width: 20px;
      height: 20px;
    }
    .trip-card-options {
      width: 40%;
      margin: 5%;
    }
    .trip-card-1 {
      width: 20%;
      margin: 10px;
      text-align: center;
    }
    .trip-card-2 {
      width: 60%;
      margin: 10px;
    }
    .trip-card-3 {
      width: 20%;
      margin: 10px;
      text-align: center;
    }
  </style>

  <template>
    <div class="trip-card-div layout horizontal">
      <div class="layout vertical center trip-card-1">
        <img src="[[imguser]]" class="trip-card-img">
        <stars-rating score="[[score]]"></stars-rating>
        <a href="[[userurl]]">[[trip.driverName]]</a>
      </div>

      <div class="horizontal-separator"></div>

      <div class="layout vertical trip-card-2">
        <div>
          <template id="citiesRepeat" is="dom-repeat" items="[[trip.cities]]" as="city">
            <span strong$="[[isSearched(index)]]">[[city]]</span><span>[[dash(index, trip.cities)]]</span>
          </template>
          <!-- <span>[[cities.departure]]</span><span> - </span>
          <template is="dom-if" if="[[departure]]">
            <span>[[departure]]</span><span> - </span>
          </template>
          <span>[[cities.arrival]]</span> -->
        </div>
        <div class="layout horizontal center">
          <div class="layout vertical center">
            <span>[[day(trip)]]</span>
            <span>[[month(trip)]]</span>
          </div>
          <div>
            <span>[[time(trip)]]</span>
          </div>
        </div>
        <div>
          <img class="trip-card-seat" src="../images/seat-icon.png">
          <span>[[trip.free]]</span><span> plazas libres</span>
        </div>
      </div>

      <div class="trip-card-3">
        <div><span>[[trip.cost]]</span>â‚¬</div>
        <span>por persona</span>
        <div class="layout horizontal center">
          <img class="trip-card-options" src="[[imageURL('pet', allow(trip.animals))]]">
          <img class="trip-card-options" src="[[imageURL('package', allow(trip.packages))]]">
        </div>
        <paper-button raised on-click="openTrip">Ver</paper-button>
      </div>
    </div>
    

    <!-- <div class="card-header layout horizontal center">

      <div class="layout vertical">
        <content select="img"></content>
        <div class="layout horizontal">
          <paper-icon-button icon="social:person-outline" on-tap=""></paper-icon-button>
          <content select="free"></content>
          <paper-icon-button icon="maps:local-shipping" on-tap="test" hidden$="{{!packages}}"></paper-icon-button>
        </div>
      </div>
      <div class="layout vertical">
      	<content select="h2"></content>
      	<content select="h3"></content>
      	<content></content>  
      </div>

      <paper-icon-button
        id="more"
        icon="more-horiz"
        on-tap="selectedTapped"
        class="right">
      </paper-icon-button>

    </div> -->
  </template>
  <script>
  //TODO instead of getting the trip per attribute bind the full trip
  Polymer({
    is: "trip-card",
    properties: {
      trip: Object
    },
    imageURL: function(type, mode) {
      return Teranga.image.URL + type + "-" + mode + ".png";
    },
    isSearched: function(i) {
      return i == this.departure || i == this.arrival;
    },
    dash: function(i) {
      // console.log(this.cities);
      // console.log("Length: " + this.cities.length + ", Index: " + i);
      return i < this.trip.cities.length - 1 ? " - " : "";
    },

    day: function(trip) {
      return Teranga.day(trip.date);
    },
    month: function(trip) {
     return Teranga.month(trip.date);
    },
    time: function(trip) {
      return Teranga.time(trip.date);
    },
    allow: function(attrib) {
      return attrib ? "allow" : ((attrib == false || attrib == 0) ? "deny" : "unknown");
    },
    openTrip: function() {
      this.fire('selected', this.trip);
    },



//     publish: {
//       selected: {
//         value: "",
//         reflect: true
//       }
//     },
//     selectedTapped: function(event, detail, sender) {
// //       document.write("TRIP-CARD");
// //       this.selected = "Seleccionado";
//       this.selected = this.tripid;
//       console.log("CHANGED SELECTED TRIP TO: " + this.tripid);
//       this.fire('selected-tap');
//     },
//     test: function() {
//       console.log(this.packages);
//     }
  });
  </script>
</dom-module>