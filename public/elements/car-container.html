<link rel="import" href="car-box.html">
<link rel="import" href="car-edit.html">

<link rel="import" href="data-service.html">
<link rel="import" href="pop-up.html">

<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">

<dom-module name="car-container">
  <template>
    <!-- <box-container on-reload="reloadCars" open="{{open}}" reloading="{{loading}}" name="Coches">
      <template is="dom-if" if="[[open]]">
        <car-service user="[[iduser]]" response="{{cars}}" on-response="loaded" fetch="all"></car-service>
      </template>

      <template id="carsRepeat" is="dom-repeat" items="[[cars]]" as="car">
        <travel-box departure="[[car.departure]]" arrival="[[car.arrival]]" day="[[day(car.dtime)]]" month="[[month(car.dtime)]]" driver="[[car.driving]]" travelurl="/"></travel-box>
      </template>
      
    </box-container> -->
    <div class="car-container">
      <data-service id="ds" type="cars" user="[[iduser]]" data="{{cars}}" on-response="loaded" fetch="all"></data-service>
      <template id="carsRepeat" is="dom-repeat" items="[[cars]]" as="car">
        <car-box car="[[car]]" on-click="carSelect"></car-box>
      </template>
      <template is="dom-if" if="[[addAllow]]">
        <car-box newcar="true" on-click="showPopup"></car-box>
      </template>
    </div>

    <!-- <iron-overlay-backdrop> -->
    <paper-dialog id="dialog" with-backdrop>
      <!-- <pop-up id="backdrop" with-backdrop> -->
        <car-edit iduser="[[iduser]]" on-newcar="carCreated" on-discard="hidePopup"></car-edit>
      <!-- </pop-up> -->
    <paper-dialog>
    <!-- </iron-overlay-backdrop> -->
  </template>

  <script>
    Polymer({
      is: "car-container",
      properties: {
        cars: {
          type: Object,
          notify: true
        },
        iduser: Number,
        open: Boolean,
        loading: Boolean,
        addAllow: Boolean
      },
      ready: function() {
        this.$.ds.reload();
      },
      reloadCars: function() {
        this.loading = true;
        this.$$("car-service").reload();
        this.$.carsRepeat.render();
      },
      showPopup: function() {
        this.$.dialog.open();
      },
      hidePopup: function() {
        this.$.dialog.close();
      },
      loaded: function() {
        this.loading = false;
      },
      carSelect: function(e) {
        this.fire('select', e.model.car);
      },
      carCreated: function(e, car) {
        this.push('cars', car);
        this.hidePopup();
      }
    });
  </script>
</dom-module>